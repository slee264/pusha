<!DOCTYPE html>
<html lang="en"> 
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/forms/scheduler.css">
  <link rel="stylesheet"
  href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css">
  <title>Scheduler</title>
</head>
<body>
  <header> Scheduler </header><br>
  <div class="scheduler-container">
    <script>
      function repeatSelectOnChange(val){
        switch(val){
          case "month":
            document.getElementById("repeat-push-subform").innerHTML = "MONTH"
            break;
          case "week":
            document.getElementById("repeat-push-subform").innerHTML = "WEEK"
            break;
          case "day":
            document.getElementById("repeat-push-subform").innerHTML = "DAY"
            break;
          case "hour": 
            document.getElementById("repeat-push-subform").innerHTML = "HOUR"
            break;
          case "minute":
            document.getElementById("repeat-push-subform").innerHTML = "MINUTE"
            break;
        }
      }
      function repeatCheckboxLabelOnChange(){
        if (repeatCheckboxBtn.checked){
          repeatCheckboxBtnLabel.innerHTML = "Repeats"
          document.getElementById('scheduler-form').innerHTML = 
            '<label for=\"repeat_options\">Choose one:</label>\
            <input type=\"hidden\" name=\"type\" value=\"repeat-push-form\" />\
            <select id="\repeatSelectId\", name=\"repeatSelect\" onchange=\"repeatSelectOnChange(this.value)\" default>\
              <option value=\"month\"> month </option>\
              <option value=\"week\"> week </option>\
              <option value=\"day\"> day </option>\
              <option value=\"hour\"> hour </option>\
              <option value=\"minute\" selected> day </option>\
            <select>\<br/>\
            <div id=\"repeat-push-subform\">\
              <input name=\"second\" placeholder=\"second\" type=\"number\" id=\"second\" min=\"0\" max=\"59\" oninvalid = \"setCustomValidity(\'Second should be between 0 and 59.\')\">\
              <input name=\"minute\" placeholder=\"minute\" type=\"number\" id=\"minute\" min=\"0\" max=\"59\" oninvalid = \"setCustomValidity(\'Minute should be between 0 and 59.\')\">\
              <input name=\"hour\" placeholder=\"hour\" type=\"number\" id=\"hour\" min=\"0\" max=\"23\" oninvalid = \"setCustomValidity(\'Hour should be between 0 and 23.\')\">\
              <input name=\"date\" placeholder=\"date\" type=\"date\" id=\"dateId\">\
            </div>\
            <input class=\"subscribe-button\" type=\"submit\" value=\"Subscribe\">'
        }else{
          repeatCheckboxBtnLabel.innerHTML = "Does not repeat"
          document.getElementById('scheduler-form').innerHTML = 
            '<input type=\"hidden\" name=\"type\" value=\"one-time-push-form\" />\
              <input name=\"second\" placeholder=\"second\" type=\"number\" id=\"second\" min=\"0\" max=\"59\" oninvalid = \"setCustomValidity(\'Second should be between 0 and 59.\')\">\
              <input name=\"minute\" placeholder=\"minute\" type=\"number\" id=\"minute\" min=\"0\" max=\"59\" oninvalid = \"setCustomValidity(\'Minute should be between 0 and 59.\')\">\
              <input name=\"hour\" placeholder=\"hour\" type=\"number\" id=\"hour\" min=\"0\" max=\"23\" oninvalid = \"setCustomValidity(\'Hour should be between 0 and 23.\')\">\
              <input name=\"date\" placeholder=\"date\" type=\"date\" id=\"dateId\">\
              <input class=\"subscribe-button\" type=\"submit\" value=\"Subscribe\">'
        }
      }
      
    </script>
    <input type="checkbox" id="repeatCheckboxBtn" onchange="repeatCheckboxLabelOnChange()">
    <label for="repeatCheckboxBtn" id="repeatCheckboxBtnLabel"> Does not repeat </label>
    <form method="POST" id="scheduler-form">
      <input type="hidden" name="type" value="one-time-push-form" />
      <input name="second" placeholder="second" type="number" id="second" min="0" max="59" oninvalid = "setCustomValidity('Second should be between 0 and 59.')">
      <input name="minute" placeholder="minute" type="number" id="minute" min="0" max="59" oninvalid = "setCustomValidity('Minute should be between 0 and 59.')">
      <input name="hour" placeholder="hour" type="number" id="hour" min="0" max="23" oninvalid = "setCustomValidity('Hour should be between 0 and 23.')">
      <input name="date" placeholder="date" type="date" id="dateId">
      <input class="subscribe-button" type="submit" value="Subscribe">
    </form>
    <div id="scheduleStr">
      
    </div>
    <script>
      function setScheduleStr(){
        let dayStr = "";
        let days = []; 
        for (let i = 0; i < recurDay.length; i++){
          if (recurDay[i].checked){
            dayStr += recurDay[i].name + ", "
          }
        }
        scheduleStr.innerHTML = "Your push notification will be sent at " + recurHour.value + " hour " + recurMinute.value + " minute " + "0" + " second " + dayStr;
        if (dayStr.length > 0){
          dayStr = dayStr.trimEnd();
          dayStr = dayStr.slice(0, dayStr.length - 1)
          scheduleStr.innerHTML = "Your push notification will be sent at " + recurHour.value + " hour " + recurMinute.value + " minute " + "0" + " second " + "every " + dayStr;
        }
      }
      console.log(recurDay);
      setScheduleStr();
    </script>
  </div>
</body>
</html>